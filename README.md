# Тесты

## Предисловие

Всего я выделил два важных блока на тестирование.

1.  Тестирование /api/ ручек
2.  e2e тесты через hermione

Наверное назвать 1 пункт "модульными" тестами весьма спорно. Но я акцентирую внимание на том,
что один эндпоинт имеет точку входа и точку выхода. То есть в моем понимании, это модуль, компоненты которого не живут
друг без друга. Возможно это проблема архитектуры сервера который я сделал, либо просто я где-то не уловил важные моменты.

Многие моменты захардкожены. Много где актуально можно причесывать.

### Тестирование ручек /api/

Тесты на API лежат здесь: ./tests/requests.test.js

По сути это прогон нескольких сценариев
(зачастую последовательно к нескольким эндпоинтам) для вопроизведения логики.

- сохранение настроек
- получение настроек
- получение билдов
- создание билдов

и т.д.

Для успешного запуска тестов нужно уже развернутое приложение на PM2
(запуск встроен в 'npm test', достаточно иметь pm2 глобально)

### Как запускать

Устанавливаем pm2 глобально если его еще нет:

```
npm i -g pm2
```

Запуск: 
```
npm test
```

При запуске тестов поднимаются процессы через pm2, прогоняются тесты, потом процессы удаляются.

### e2e тесты через hermione

-   конфиг .hermione.conf.js
-   тесты tests/desktop

Основная проблема тестов на hermione - это поставить hermione !)

Выделил два основных блока сценариев:
- работа с настройками
- работа с билдами

# CI Server

Для запуска нужна нода 12.10, использую fs.rmdirSync

Разворачиваю с помощью pm2

### Как запускать

Устанавливаем pm2:

```
npm i -g pm2
```

Для переменных окружения есть файл getEnvs.js.example
Туда вбиваем секреты. Он импортируется в конфиг pm2

Есть PostMan конфиг в папке postman

### Тезисы

- При изменении настроек - удаляю их предварительно, потому что очищается тем самым список билдов
 и удаляю репозиторий

- Микросервисы:
    - Сервер - клиент
    - Воркер над репозиторием
    - Билдер

- Для запросов - axios, предварительно обернул в инстанс и оформил, как хелпер. Чтобы не плодить код.